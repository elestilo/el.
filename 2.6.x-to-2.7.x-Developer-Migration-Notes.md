<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**

- [Notification email sending](#notification-email-sending)
- [Order post dates](#order-post-dates)
- [Array return values being swapped out with objects implementing ArrayAccess](#array-return-values-being-swapped-out-with-objects-implementing-arrayaccess)
- [Variation actions/filters prefixes](#variation-actionsfilters-prefixes)
- [Objects are passed by reference to actions/filters](#objects-are-passed-by-reference-to-actionsfilters)
- [Variation IDs](#variation-ids)
- [Select2 Version 4](#select2-version-4)
  - [wc-product-search inputs](#wc-product-search-inputs)
  - [Field name](#field-name)
  - [Multiple attribute](#multiple-attribute)
  - [Handling the POSTed data](#handling-the-posted-data)
  - [wc-customer-search inputs](#wc-customer-search-inputs)
  - [Checking POSTed data](#checking-posted-data)
- [Order version property](#order-version-property)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Notification email sending

In 2.6.x, email notifications were sent in the same request as the order status change.

In 2.7.x, they are instead queued using WP Cron and send in a separate request.

If using actions to stop emails sending, your code will need to handle the new system. https://github.com/woocommerce/woocommerce/issues/13318

---

## Order post dates

As pointed out in https://github.com/woocommerce/woocommerce/issues/13380, orders in 2.6.x would have their post dates updated when moving from pending to some other status. 

In 2.7.x, the post date is the date the order was created. This will no longer change unless explicitly set.

---

## Array return values being swapped out with objects implementing ArrayAccess

In some places, 2.6.x returned arrays representing data such as taxes. In 2.7.x, proper classes have been added instead. These new classes implement ArrayAccess so old code trying to reference values in the 'array' still functions.

There is one caveat to this; if you check returned data to see if it's an array with `is_array` this check will return `false` since it's not an array in 2.7.x, it's an object. This will fail silently so needs to be checked in the extension code.

New classes implementing ArrayAccess as are follows:

- `WC_Product_Download`
- `WC_Product_Attribute`
- `WC_Order_Item`
  - `WC_Order_Item_Coupon`
  - `WC_Order_Item_Fee`
  - `WC_Order_Item_Product`
  - `WC_Order_Item_Shipping`
  - `WC_Order_Item_Tax`
- `WC_Customer_Download`

This is a list of methods which returned arrays in 2.6.x, but objects in 2.7.x:

- `WC_Product::get_file()`
- `WC_Product::get_files()`
- `WC_Product::get_attributes()`
- `WC_Order::get_item();`
- `WC_Abstract_Order::get_items();`
- `WC_Abstract_Order::get_fees()`
- `WC_Abstract_Order::get_taxes()`
- `WC_Abstract_Order::get_shipping_methods()`

--

## Variation actions/filters prefixes

`woocommerce_get_regular_price/sale_price` filters were in the abstract in 2.6.x. For products, these hooks are replaced with `woocommerce_get_product_regular_price` and `woocommerce_get_product_sale_price` and mapped so existing filters continue to function.

The exception is with product variations - these have their own hook prefix making them `woocommerce_get_product_variation_regular_price` and `woocommerce_get_product_variation_sale_price`. There is no mapping in place for these filters.

---

## Objects are passed by reference to actions/filters

If you're being passed a CRUD object via an action or filter hook, **changes you make to said object will persist**. If you need to change object properties without doing this, clone the variable.

```
// Create a clone to ensure item totals will not be modified permanently.
$item = clone $item;
```

---

## Variation IDs

In 2.6.x, `$variation->id` was the ID of the parent product, and `$variation->variation_id` was the ID of the variation. Backwards compatibility is maintained, but when moving to CRUD ensure you use the correct getters and setters. 

`$variation->get_id()` is the variation ID.
`$variation->get_parent_id()` is the parent product ID.

---

## Select2 Version 4

From WC Beta 2, we've migrated to Select2 V4.

Select2 V4 is mostly compatible with Select2 V3 with a few exceptions, the main one being how AJAX search inputs work. WooCommerce has two instances of these which are affected and need some HTML markup changes to function.

### wc-product-search inputs

These inputs were 'hidden' text inputs in v3. In v4 these needs to be changed to regular multiselect elements.

_Example:_

```
<input type="hidden" id="grant_access_id" name="grant_access_id" data-multiple="true" class="wc-product-search" style="width: 400px;" data-placeholder="<?php esc_attr_e( 'Search for a downloadable product&hellip;', 'woocommerce' ); ?>" data-action="woocommerce_json_search_downloadable_products_and_variations" />
```

Would be changed to a regular multiselect field:

```
<select id="grant_access_id" class="wc-product-search" name="grant_access_id[]" multiple="multiple" style="width: 400px;" data-placeholder="<?php esc_attr_e( 'Search for a downloadable product&hellip;', 'woocommerce' ); ?>" data-action="woocommerce_json_search_downloadable_products_and_variations"></select>
```

### Field name

Note that the field name in this case was changed from grant_access_id to grant_access_id[].

### Multiple attribute

`data-multiple` is no longer needed. The multiple prop is added instead. This supports multiple selections.

### Handling the POSTed data

In the previous example, the hidden input would have posted a comma delimited string of IDs. With the switch to multi selects, this code needs to handle an array of values instead.

### wc-customer-search inputs

Handled in the same way as `wc-product-search`.

### Checking POSTed data

Unlike hidden inputs, if no selections are made multi-selects do not POST. Your code needs to check if the field `isset()` to deal with posted values and handles scenarios where no selections are made.

---

## Order version property

With 2.3.7-2.6.x:

changing order line items via the admin interface would update them to the WC > 2.3.7 structure (in wc_save_order_items()), because of this, it would update the order version. This is the only time the version data is actually different between WC < 2.3.7 and 2.3.7-2.6.14 so it's the only time the order version if updated.
changing order line items via any other method, be it the REST API, CLI or another API function (e.g. WC_Abstract_Order::add_tax()) would not definitively update the structure to the WC > 2.3.7 structure, so it would not update the order version. The calling code could update them to the newer structure, and if it chose to, it would be responsible for also updating the order version.
changing any other data via any other method won't update the order version, because nothing has changed in terms of how the data is stored.
tl;dr - the order version on orders with WC < 2.7 almost never changed, because the data structure almost never changed.

With 2.7.x:

changing order line items via the admin interface would update them to the WC > 2.3.7 structure so it would update the order version (even if there are no changes to the structure).
changing order line items via any other method, be it the REST API, CLI or another API function would update the structure to the WC > 2.7.x structure, so it would update the order version (even if there are no changes to the structure).
changing any other data via any other method would update the order version, even if nothing has changed in terms of how the order is being stored, but if something has changed, it will be updated.
tl;dr - the order version on orders with WC 2.7+ will always change, even if the data structure hasn't changed, but the order version will also always reflect the version of the structure.

https://github.com/woocommerce/woocommerce/issues/13381#event-979557696